/**
 * skylark-utils-md - The skylark md utility library.
 * @author [object Object]
 * @version v0.9.0
 * @link http://www.skylarkjs.org
 * @license MIT
 */
!function(e,t){function n(e,t){if("."!==e[0])return e;var n=t.split("/"),r=e.split("/");n.pop();for(var i=0;i<r.length;i++)"."!=r[i]&&(".."==r[i]?n.pop():n.push(r[i]));return n.join("/")}var r=t.define,i=t.require,s="function"==typeof r&&r.amd,o=!s&&"undefined"!=typeof exports;if(!s&&!r){var a={};r=t.define=function(e,t,r){"function"==typeof r?(a[e]={factory:r,deps:t.map(function(t){return n(t,e)}),exports:null},i(e)):a[e]=r},i=t.require=function(e){if(!a.hasOwnProperty(e))throw new Error("Module "+e+" has not been defined");var t=a[e];if(!t.exports){var n=[];t.deps.forEach(function(e){n.push(i(e))}),t.exports=t.factory.apply(window,n)}return t.exports}}if(!r)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(e(r,i),!s){var u=i("skylark-langx/skylark");o?exports=u:t.skylarkjs=u}}(function(define,require){define("skylark-langx/skylark",[],function(){var e={};return e}),define("skylark-utils-md/markdown",["skylark-langx/skylark"],function(e){return e.markdown=e.markdown||{}}),define("skylark-langx/types",[],function(){function e(e){return e&&e.constructor===Array}function t(e){return!h(e)&&!a(e)&&"number"==typeof e.length&&!o(e)}function n(e){return"boolean"==typeof e}function r(e){return"undefined"!=typeof e}function i(e){return null!=e&&e.nodeType==e.DOCUMENT_NODE}function s(e){var t;for(t in e)if(null!==e[t])return!1;return!0}function o(e){return"function"==d(e)}function a(e){return e&&e instanceof Node}function u(e){return"number"==typeof e}function l(e){return"object"==d(e)}function c(e){return l(e)&&!f(e)&&Object.getPrototypeOf(e)==Object.prototype}function h(e){return"string"==typeof e}function f(e){return e&&e==e.window}function p(e){if(e){var t=location.protocol+"//"+location.hostname;return location.port&&(t+=":"+location.port),e.startsWith(t)}}var d=function(){var e={};return"Boolean Number String Function Array Date RegExp Object Error".split(" ").forEach(function(t){e["[object "+t+"]"]=t.toLowerCase()}),function(t){return null==t?String(t):e[toString.call(t)]||"object"}}();return{isArray:e,isArrayLike:t,isBoolean:n,isDefined:r,isDocument:i,isEmptyObject:s,isFunction:o,isHtmlNode:a,isNumber:u,isObject:l,isPlainObject:c,isString:h,isSameOrigin:p,isWindow:f,type:d}}),define("skylark-langx/objects",["./types"],function(e){function t(e,t){return function(n){var r=arguments.length;if(t&&(n=Object(n)),r<2||null==n)return n;for(var i=1;i<r;i++)for(var s=arguments[i],o=e(s),a=o.length,u=0;u<a;u++){var l=o[u];t&&void 0!==n[l]||(n[l]=s[l])}return n}}function n(e){if(!j(e))return[];var t=[];for(var n in e)t.push(n);return t}function r(e,t){var n,r,i,s,o;if(e)if(n=e.length,n===s){for(r in e)if(e.hasOwnProperty(r)&&(o=e[r],t.call(o,r,o)===!1))break}else for(i=0;i<n&&(o=e[i],t.call(o,i,o)!==!1);i++);return this}function i(e){var t,n=x.call(arguments,1);return"boolean"==typeof e&&(t=e,e=n.shift()),0==n.length&&(n=[e],e=this),n.forEach(function(n){h(e,n,t)}),e}function s(e){if(j(e))return[];var t=[];for(var n in e)o(e,n)&&t.push(n);return t}function o(e,t){if(!S(t))return null!=e&&b.call(e,t);for(var n=t.length,r=0;r<n;r++){var i=t[r];if(null==e||!b.call(e,i))return!1;e=e[i]}return!!n}function a(e,t){return m(e,t)}function u(e,t){var n=n(t),r=n.length;if(null==e)return!r;for(var i=Object(e),s=0;s<r;s++){var o=n[s];if(t[o]!==i[o]||!(o in i))return!1}return!0}function l(e,t,n,r){for(var i in t)r&&void 0!==e[i]||(n&&(A(t[i])||S(t[i]))?(A(t[i])&&!A(e[i])&&(e[i]={}),S(t[i])&&!S(e[i])&&(e[i]=[]),l(e[i],t[i],n,r)):void 0!==t[i]&&(e[i]=t[i]));return e}function c(e){var t=x.call(arguments,0),n=t.shift(),r=!1;return k(t[t.length-1])&&(r=t.pop()),{target:n,sources:t,deep:r}}function h(){var e=c.apply(this,arguments);return e.sources.forEach(function(t){l(e.target,t,e.deep,!1)}),e.target}function f(e,t){if(S(e)){var n=e.indexOf(t);n!=-1&&e.splice(n,1)}else if(A(e))for(var r in e)if(e[r]==t){delete e[r];break}return this}function p(e,t,n){S(t)||(t=[t]);var r=t.length;if(!r)return w(n)?n.call(e):n;for(var i=0;i<r;i++){var s=null==e?void 0:e[t[i]];void 0===s&&(s=n,i=r),e=w(s)?s.call(e):s}return e}function d(){var e=c.apply(this,arguments);return e.sources.forEach(function(t){l(e.target,t,e.deep,!0)}),e.target}function g(e){for(var t=_.keys(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=e[t[i]];return r}function y(e,t){var n;if(void 0===e||null===e)n=e;else if(t&&e.clone)n=e.clone();else if(S(e)){n=[];for(var r=0;r<e.length;r++)n.push(y(e[r]))}else if(A(e)){n={};for(var i in e)n[i]=y(e[i])}else n=e;return n}var m,v,b=Object.prototype.hasOwnProperty,x=Array.prototype.slice,k=e.isBoolean,w=e.isFunction,j=e.isObject,A=e.isPlainObject,S=e.isArray,E="undefined"!=typeof Symbol?Symbol.prototype:null;return m=function(e,t,n,r){if(e===t)return 0!==e||1/e===1/t;if(null==e||null==t)return!1;if(e!==e)return t!==t;var i=typeof e;return("function"===i||"object"===i||"object"==typeof t)&&v(e,t,n,r)},v=function(e,t,n,r){var i=toString.call(e);if(i!==toString.call(t))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!==+e?+t!==+t:0===+e?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t;case"[object Symbol]":return E.valueOf.call(e)===E.valueOf.call(t)}var s="[object Array]"===i;if(!s){if("object"!=typeof e||"object"!=typeof t)return!1;var o=e.constructor,a=t.constructor;if(o!==a&&!(w(o)&&o instanceof o&&w(a)&&a instanceof a)&&"constructor"in e&&"constructor"in t)return!1}n=n||[],r=r||[];for(var u=n.length;u--;)if(n[u]===e)return r[u]===t;if(n.push(e),r.push(t),s){if(u=e.length,u!==t.length)return!1;for(;u--;)if(!m(e[u],t[u],n,r))return!1}else{var l,c=Object.keys(e);if(u=c.length,Object.keys(t).length!==u)return!1;for(;u--;)if(l=c[u],void 0===t[l]||!m(e[l],t[l],n,r))return!1}return n.pop(),r.pop(),!0},{allKeys:n,clone:y,defaults:t(n,!0),each:r,extend:i,has:o,isEqual:a,isMatch:u,keys:s,mixin:h,removeItem:f,result:p,safeMixin:d,values:g}}),define("skylark-langx/arrays",["./types","./objects"],function(e,t){function n(e){return u.call(e,function(e){return null!=e})}function r(e){if(l(e)){for(var t=[],n=0;n<e.length;n++){var r=e[n];if(l(r))for(var i=0;i<r.length;i++)t.push(r[i]);else t.push(r)}return t}return e}function i(e,t){if(!t)return-1;var n;if(t.indexOf)return t.indexOf(e);for(n=t.length;n--;)if(t[n]===e)return n;return-1}function s(e,t,n){return l(e)?(n||[]).concat(Array.prototype.slice.call(e,t||0)):[e]}function o(e,t){var n,i,s,o=[];if(l(e))for(i=0;i<e.length;i++)n=t.call(e[i],e[i],i),null!=n&&o.push(n);else for(s in e)n=t.call(e[s],e[s],s),null!=n&&o.push(n);return r(o)}function a(e){return u.call(e,function(t,n){return e.indexOf(t)==n})}var u=Array.prototype.filter,l=e.isArrayLike;return{compact:n,first:function(e,t){return t?e.slice(0,t):e[0]},each:t.each,flatten:r,inArray:i,makeArray:s,map:o,uniq:a}}),define("skylark-langx/klass",["./arrays","./objects","./types"],function(e,t,n){var r=e.uniq,i=t.has,s=t.mixin,o=n.isArray,a=n.isDefined,u=function(){function e(e,t,n){var r=e.prototype,i=e.superclass.prototype,s=n&&n.noOverrided;for(var o in t)if("constructor"!==o){var a=t[o];"function"==typeof t[o]?r[o]=a._constructor||s||"function"!=typeof i[o]?a:function(e,t,n){return function(){var e=this.overrided;this.overrided=n;var r=t.apply(this,arguments);return this.overrided=e,r}}(o,a,i[o]):"object"==typeof a&&null!==a&&a.get?Object.defineProperty(r,o,a):r[o]=a}return e}function t(e,t){var n=[];return t.forEach(function(e){if(i(e,"__mixins__"))throw new Error("nested mixins");for(var t=[];e;)t.unshift(e),e=e.superclass;n=n.concat(t)}),n=r(n),n=n.filter(function(t){for(var n=e;n;){if(t===n)return!1;if(i(n,"__mixins__"))for(var r=n.__mixins__,s=0;s<r.length;s++)if(r[s]===t)return!1;n=n.superclass}return!0}),n.length>0&&n}function n(e,t){for(var n=e,r=0;r<t.length;r++){var i=new Function;i.prototype=Object.create(n.prototype),i.__proto__=n,i.superclass=null,s(i.prototype,t[r].prototype),i.prototype.__mixin__=t[r],n=i}return n}return function u(r,i,s,l){o(i)&&(l=s,s=i,i=null),i=i||Object,a(s)&&!o(s)&&(l=s,s=!1);var c=i;s&&(s=t(c,s)),s&&(c=n(c,s));var h=r._construct;h||(h=function(){if(this.init)return this.init.apply(this,arguments)});var f=r.klassName||"",p=new Function("return function "+f+"() {var inst = this, ctor = arguments.callee;if (!(inst instanceof ctor)) {inst = Object.create(ctor.prototype);}return ctor._constructor.apply(inst, arguments) || inst;}")();return p._constructor=h,p.prototype=Object.create(c.prototype),p.prototype.constructor=p,p.superclass=i,p.__proto__=c,s&&(p.__mixins__=s),p.partial||(p.partial=function(t,n){return e(this,t,n)}),p.inherit||(p.inherit=function(e,t,n){return u(e,this,t,n)}),p.partial(r,l),p}},l=u();return l}),define("skylark-langx/ArrayStore",["./klass"],function(e){var t=function(e,t){function n(e,t,n){var r,i=0,s=e&&e.length||0,o=[];if(s&&"string"==typeof e&&(e=e.split("")),"string"==typeof t&&(t=cache[t]||buildFn(t)),n)for(;i<s;++i)r=e[i],t.call(n,r,i,e)&&o.push(r);else for(;i<s;++i)r=e[i],t(r,i,e)&&o.push(r);return o}function r(r){var i=n(r,e),s=t&&t.sort;if(s&&i.sort("function"==typeof s?s:function(e,t){for(var n,r=0;n=s[r];r++){var i=e[n.attribute],o=t[n.attribute];if(i=null!=i?i.valueOf():i,o=null!=o?o.valueOf():o,i!=o)return!!n.descending==(null==i||i>o)?-1:1}return 0}),t&&(t.start||t.count)){var o=i.length;i=i.slice(t.start||0,(t.start||0)+(t.count||1/0)),i.total=o}return i}switch(typeof e){default:throw new Error("Can not query with a "+typeof e);case"object":case"undefined":var i=e;e=function(e){for(var t in i){var n=i[t];if(n&&n.test){if(!n.test(e[t],e))return!1}else if(n!=e[t])return!1}return!0};break;case"string":if(!this[e])throw new Error("No filter function "+e+" was found in store");e=this[e];case"function":}return r.matches=e,r},n=function(e){function t(t){e[t]=function(){var i=arguments,s=Deferred.when(e,function(e){return n(Array.prototype[t].apply(e,i))});if("forEach"!==t||r)return s}}if(!e)return e;var r=!!e.then;return r&&(e=Object.delegate(e)),t("forEach"),t("filter"),t("map"),null==e.total&&(e.total=Deferred.when(e,function(e){return e.length})),e},r=e({klassName:"ArrayStore",queryEngine:t,idProperty:"id",get:function(e){return this.data[this.index[e]]},getIdentity:function(e){return e[this.idProperty]},put:function(e,t){var n=this.data,r=this.index,i=this.idProperty,s=e[i]=t&&"id"in t?t.id:i in e?e[i]:Math.random();if(s in r){if(t&&t.overwrite===!1)throw new Error("Object already exists");n[r[s]]=e}else r[s]=n.push(e)-1;return s},add:function(e,t){return(t=t||{}).overwrite=!1,this.put(e,t)},remove:function(e){var t=this.index,n=this.data;if(e in t)return n.splice(t[e],1),this.setData(n),!0},query:function(e,t){return n(this.queryEngine(e,t)(this.data))},setData:function(e){e.items?(this.idProperty=e.identifier||this.idProperty,e=this.data=e.items):this.data=e,this.index={};for(var t=0,n=e.length;t<n;t++)this.index[e[t][this.idProperty]]=t},init:function(e){for(var t in e)this[t]=e[t];this.setData(this.data||[])}});return r}),define("skylark-langx/aspect",[],function(){function e(e,t,n,i){var s,o=e[t],a="around"==t;if(a){var u=n(function(){return o.advice(this,arguments)});s={remove:function(){u&&(u=e=n=null)},advice:function(e,t){return u?u.apply(e,t):o.advice(e,t)}}}else s={remove:function(){if(s.advice){var r=s.previous,i=s.next;i||r?(r?r.next=i:e[t]=i,i&&(i.previous=r)):delete e[t],e=n=s.advice=null}},id:r++,advice:n,receiveArguments:i};if(o&&!a)if("after"==t){for(;o.next&&(o=o.next););o.next=s,s.previous=o}else"before"==t&&(e[t]=s,s.next=o,o.previous=s);else e[t]=s;return s}function t(t){return function(i,s,o,a){var u,l=i[s];l&&l.target==i||(i[s]=u=function(){for(var e=r,t=arguments,i=u.before;i;)t=i.advice.apply(this,t)||t,i=i.next;if(u.around)var s=u.around.advice(this,t);for(var o=u.after;o&&o.id<e;){if(o.receiveArguments){var a=o.advice.apply(this,t);s=a===n?s:a}else s=o.advice.call(this,s,t);o=o.next}return s},l&&(u.around={advice:function(e,t){return l.apply(e,t)}}),u.target=i);var c=e(u||l,t,o,a);return o=null,c}}var n,r=0;return{after:t("after"),around:t("around"),before:t("before")}}),define("skylark-langx/funcs",["./objects","./types"],function(e,t){function n(e){return requestAnimationFrame?requestAnimationFrame(e):setTimeoutout(e),this}function r(){}function i(e,t){var n=2 in arguments&&slice.call(arguments,2);if(a(e)){var r=function(){return e.apply(t,n?n.concat(slice.call(arguments)):arguments)};return r}if(u(t))return n?(n.unshift(e[t],e),i.apply(null,n)):i(e[t],e);throw new TypeError("expected function")}function s(e,t){var n;return function(){var r=this,i=arguments,s=function(){n=null,e.apply(r,i)};n&&clearTimeout(n),n=setTimeout(s,t)}}var o=e.mixin,a=t.isFunction,u=t.isString,l=function(){function e(){}return function(t,n){e.prototype=t;var r=new e;return e.prototype=null,n&&o(r,n),r}}();return{debounce:s,delegate:l,defer:n,noop:r,proxy:i,returnTrue:function(){return!0},returnFalse:function(){return!1}}}),define("skylark-langx/Deferred",["./arrays","./funcs","./objects"],function(e,t,n){"use strict";function r(e,t){var n={state:function(){return t.isResolved()?"resolved":t.isRejected()?"rejected":"pending"},then:function(e,t,r){return r&&this.progress(r),l(Promise.prototype.then.call(this,e&&function(t){return t&&void 0!==t.__ctx__?e.apply(t.__ctx__,t):e(t)},t&&function(e){return e&&void 0!==e.__ctx__?t.apply(e.__ctx__,e):t(e)}),n)},progress:function(e){return t[i].push(e),this}};return n.pipe=n.then,l(e,n)}var i=Symbol?Symbol():"__pglisteners",s=Array.prototype.slice,o=t.proxy,a=e.makeArray,u=n.result,l=n.mixin;l(Promise.prototype,{always:function(e){return this.then(e,e),this},done:function(e){return this.then(e),this},fail:function(e){return this["catch"](e),this}});var c=function(){var e=this,t=this.promise=new Promise(function(t,n){e._resolve=t,e._reject=n});r(t,e),this[i]=[]};return c.prototype.resolve=function(e){var t=s.call(arguments);return this.resolveWith(null,t)},c.prototype.resolveWith=function(e,t){return t=t?a(t):[],t.__ctx__=e,this._resolve(t),this._resolved=!0,this},c.prototype.progress=function(e){try{return this[i].forEach(function(t){return t(e)})}catch(t){this.reject(t)}return this},c.prototype.reject=function(e){var t=s.call(arguments);return this.rejectWith(null,t)},c.prototype.rejectWith=function(e,t){return t=t?a(t):[],t.__ctx__=e,this._reject(t),this._rejected=!0,this},c.prototype.isResolved=function(){return!!this._resolved},c.prototype.isRejected=function(){return!!this._rejected},c.prototype.then=function(e,t,n){var r=u(this,"promise");return r.then(e,t,n)},c.prototype.done=c.prototype.then,c.all=function(e){return r(Promise.all(e))},c.first=function(e){return r(Promise.race(e))},c.when=function(e,t,n,r){var i=e&&"function"==typeof e.then,s=i&&e instanceof Promise;if(!i)return arguments.length>1?t?t(e):e:(new c).resolve(e);if(!s){var a=new c(e.cancel);e.then(o(a.resolve,a),o(a.reject,a),a.progress),e=a.promise}return t||n||r?e.then(t,n,r):e},c.reject=function(e){var t=new c;return t.reject(e),t.promise},c.resolve=function(e){var t=new c;return t.resolve.apply(t,arguments),t.promise},c.immediate=c.resolve,c}),define("skylark-langx/async",["./Deferred","./arrays"],function(e,t){var n=t.each,r={parallel:function(t,r,i){var s=[];return i=i||null,r=r||[],n(t,function(e,t){s.push(t.apply(i,r))}),e.all(s)},series:function(t,r,i){var s=[],o=new e,a=o.promise;return i=i||null,r=r||[],o.resolve(),n(t,function(e,t){a=a.then(function(){return t.apply(i,r)}),s.push(a)}),e.all(s)},waterful:function(t,r,i){var s=new e,o=s.promise;return i=i||null,r=r||[],s.resolveWith(i,r),n(t,function(e,t){o=o.then(t)}),o}};return r}),define("skylark-langx/Evented",["./klass","./objects","./types"],function(e,t,n){var r=Array.prototype.slice,i=n.isDefined,s=n.isPlainObject,o=n.isFunction,a=n.isString,u=n.isEmptyObject,l=t.mixin,c=e({on:function(e,t,n,r,i,u){var l=this,c=this._hub||(this._hub={});return s(e)?(i=r,each(e,function(e,r){l.on(e,t,n,r,i,u)}),this):(a(t)||o(r)||(i=r,r=n,n=t,t=void 0),o(n)&&(i=r,r=n,n=null),a(e)&&(e=e.split(/\s/)),e.forEach(function(e){(c[e]||(c[e]=[])).push({fn:r,selector:t,data:n,ctx:i,one:u})}),this)},one:function(e,t,n,r,i){return this.on(e,t,n,r,i,1)},trigger:function(e){if(!this._hub)return this;var t=this;a(e)&&(e=new CustomEvent(e)),Object.defineProperty(e,"target",{value:this});var n=r.call(arguments,1);return n=i(n)?[e].concat(n):[e],[e.type||e.name,"all"].forEach(function(r){var i=t._hub[r];if(i){for(var s=i.length,o=!1,a=0;a<s;a++){var u=i[a];e.data?u.data&&(e.data=l({},u.data,e.data)):e.data=u.data||null,u.fn.apply(u.ctx,n),u.one&&(i[a]=null,o=!0)}o&&(t._hub[r]=compact(i))}}),this},listened:function(e){var t=(this._hub||(this._events={}))[e]||[];return t.length>0},listenTo:function(e,t,n,r){if(!e)return this;a(n)&&(n=this[n]),r?e.one(t,n,this):e.on(t,n,this);for(var i,s=this._listeningTo||(this._listeningTo=[]),o=0;o<s.length;o++)if(s[o].obj==e){i=s[o];break}i||s.push(i={obj:e,events:{}});var u=i.events,l=u[t]=u[t]||[];return l.indexOf(n)==-1&&l.push(n),this},listenToOnce:function(e,t,n){return this.listenTo(e,t,n,1)},off:function(e,t){var n=this._hub||(this._hub={});return a(e)&&(e=e.split(/\s/)),e.forEach(function(e){var r=n[e],i=[];if(r&&t)for(var s=0,o=r.length;s<o;s++)r[s].fn!==t&&r[s].fn._!==t&&i.push(r[s]);i.length?n[e]=i:delete n[e]}),this},unlistenTo:function(e,t,n){var r=this._listeningTo;if(!r)return this;for(var i=0;i<r.length;i++){var s=r[i];if(!e||e==s.obj){var o=s.events;for(var a in o)if(!t||t==a){for(var l=o[a],c=0;c<l.length;c++)n&&n!=l[i]||(s.obj.off(a,l[i],this),l[i]=null);l=o[a]=compact(l),u(l)&&(o[a]=null)}u(o)&&(r[i]=null)}}return r=this._listeningTo=compact(r),u(r)&&(this._listeningTo=null),this}});return c}),define("skylark-langx/strings",[],function(){function e(e){return e.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function t(e){try{return e?"true"==e||"false"!=e&&("null"==e?null:+e+""==e?+e:/^[\[\{]/.test(e)?JSON.parse(e):e):e}catch(t){return e}}function n(e){return null==e?"":String.prototype.trim.call(e)}function r(e,t,n,r){function i(e,t){if(e.match(/\./)){var n,r=function(e,t){var i=e.pop();return i?t[i]?r(e,n=t[i]):null:n};return r(e.split(".").reverse(),t)}return t[e]}return r=r||window,n=n?proxy(r,n):function(e){return e},e.replace(/\$\{([^\s\:\}]+)(?:\:([^\s\:\}]+))?\}/g,function(e,s,o){var a=i(s,t);return o&&(a=i(o,r).call(r,a,s)),n(a,s).toString()})}return{camelCase:function(e){return e.replace(/-([\da-z])/g,function(e){return e.toUpperCase().replace("-","")})},dasherize:e,deserializeValue:t,lowerFirst:function(e){return e.charAt(0).toLowerCase()+e.slice(1)},serializeValue:function(e){return JSON.stringify(e)},substitute:r,trim:n,upperFirst:function(e){return e.charAt(0).toUpperCase()+e.slice(1)}}}),define("skylark-langx/Xhr",["./arrays","./Deferred","./Evented","./objects","./funcs","./types"],function(arrays,Deferred,Evented,objects,funcs,types){var each=arrays.each,mixin=objects.mixin,noop=funcs.noop,isArray=types.isArray,isFunction=types.isFunction,isPlainObject=types.isPlainObject,type=types.type,getAbsoluteUrl=function(){var e;return function(t){return e||(e=document.createElement("a")),e.href=t,e.href}}(),Xhr=function(){function mimeToDataType(e){if(e&&(e=e.split(";",2)[0]),e){if(e==htmlType)return"html";if(e==jsonType)return"json";if(scriptTypeRE.test(e))return"script";if(xmlTypeRE.test(e))return"xml"}return"text"}function appendQuery(e,t){return""==t?e:(e+"&"+t).replace(/[&?]{1,2}/,"?")}function serializeData(e){e.data=e.data||e.query,e.processData&&e.data&&"string"!=type(e.data)&&(e.data=param(e.data,e.traditional)),!e.data||e.type&&"GET"!=e.type.toUpperCase()||(e.url=appendQuery(e.url,e.data),e.data=void 0)}function serialize(e,t,n,r){var i,s=isArray(t),o=isPlainObject(t);each(t,function(t,a){i=type(a),r&&(t=n?r:r+"["+(o||"object"==i||"array"==i?t:"")+"]"),!r&&s?e.add(a.name,a.value):"array"==i||!n&&"object"==i?serialize(e,a,n,t):e.add(t,a)})}var jsonpID=0,key,name,rscript=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,scriptTypeRE=/^(?:text|application)\/javascript/i,xmlTypeRE=/^(?:text|application)\/xml/i,jsonType="application/json",htmlType="text/html",blankRE=/^\s*$/,XhrDefaultOptions={async:!0,type:"GET",beforeSend:noop,success:noop,error:noop,complete:noop,context:null,global:!0,accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:"application/json",xml:"application/xml, text/xml",html:"text/html",text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0,xhrFields:{withCredentials:!0}},param=function(e,t){var n=[];return n.add=function(e,t){isFunction(t)&&(t=t()),null==t&&(t=""),this.push(escape(e)+"="+escape(t))},serialize(n,e,t),n.join("&").replace(/%20/g,"+")},Xhr=Evented.inherit({klassName:"Xhr",_request:function(args){var _=this._,self=this,options=mixin({},XhrDefaultOptions,_.options,args),xhr=_.xhr=new XMLHttpRequest;serializeData(options);var dataType=options.dataType||options.handleAs,mime=options.mimeType||options.accepts[dataType],headers=options.headers,xhrFields=options.xhrFields,isFormData=options.data&&options.data instanceof FormData,basicAuthorizationToken=options.basicAuthorizationToken,type=options.type,url=options.url,async=options.async,user=options.user,password=options.password,deferred=new Deferred,contentType=!isFormData&&"application/x-www-form-urlencoded";if(xhrFields)for(name in xhrFields)xhr[name]=xhrFields[name];mime&&mime.indexOf(",")>-1&&(mime=mime.split(",",2)[0]),mime&&xhr.overrideMimeType&&xhr.overrideMimeType(mime);var finish=function(){xhr.onloadend=noop,xhr.onabort=noop,xhr.onprogress=noop,xhr.ontimeout=noop,xhr=null},onloadend=function(){var result,error=!1;if(xhr.status>=200&&xhr.status<300||304==xhr.status||0==xhr.status&&getAbsoluteUrl(url).startsWith("file:")){dataType=dataType||mimeToDataType(options.mimeType||xhr.getResponseHeader("content-type")),result=xhr.responseText;try{"script"==dataType?eval(result):"xml"==dataType?result=xhr.responseXML:"json"==dataType?result=blankRE.test(result)?null:JSON.parse(result):"blob"==dataType?result=Blob([xhrObj.response]):"arraybuffer"==dataType&&(result=xhr.reponse)}catch(e){error=e}error?deferred.reject(error,xhr.status,xhr):deferred.resolve(result,xhr.status,xhr)}else deferred.reject(new Error(xhr.statusText),xhr.status,xhr);finish()},onabort=function(){deferred&&deferred.reject(new Error("abort"),xhr.status,xhr),finish()},ontimeout=function(){deferred&&deferred.reject(new Error("timeout"),xhr.status,xhr),finish()},onprogress=function(e){deferred&&deferred.progress(e,xhr.status,xhr)};if(xhr.onloadend=onloadend,xhr.onabort=onabort,xhr.ontimeout=ontimeout,xhr.onprogress=onprogress,xhr.open(type,url,async,user,password),headers)for(var key in headers){var value=headers[key];"content-type"===key.toLowerCase()?contentType=headers[hdr]:xhr.setRequestHeader(key,value)}return contentType&&contentType!==!1&&xhr.setRequestHeader("Content-Type",contentType),headers&&"X-Requested-With"in headers||xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),basicAuthorizationToken&&xhr.setRequestHeader("Authorization",basicAuthorizationToken),xhr.send(options.data?options.data:null),deferred.promise},abort:function(){var e=this._,t=e.xhr;t&&t.abort()},request:function(e){return this._request(e)},get:function(e){return e=e||{},e.type="GET",this._request(e)},post:function(e){return e=e||{},e.type="POST",this._request(e)},patch:function(e){return e=e||{},e.type="PATCH",this._request(e)},put:function(e){return e=e||{},e.type="PUT",this._request(e)},del:function(e){return e=e||{},e.type="DELETE",this._request(e)},init:function(e){this._={options:e||{}}}});return["request","get","post","put","del","patch"].forEach(function(e){Xhr[e]=function(t,n){var r=new Xhr({url:t});return r[e](n)}}),Xhr.defaultOptions=XhrDefaultOptions,Xhr.param=param,Xhr}();return Xhr}),define("skylark-langx/Restful",["./Evented","./objects","./strings","./Xhr"],function(e,t,n,r){var i=t.mixin,s=n.substitute,o=e.inherit({klassName:"Restful",idAttribute:"id",getBaseUrl:function(e){var t=s(this.baseEndpoint,e),n=this.server+this.basePath+t;return void 0!==e[this.idAttribute]&&(n=n+"/"+e[this.idAttribute]),n},_head:function(e){},_get:function(e){return r.get(this.getBaseUrl(e),e)},_post:function(e,t){var n=this.getBaseUrl(e);return t&&(n=n+"/"+t),r.post(n,e)},_put:function(e,t){var n=this.getBaseUrl(e);return t&&(n=n+"/"+t),r.put(n,e)},_delete:function(e){var t=this.getBaseUrl(e);return r.del(t)},_patch:function(e){var t=this.getBaseUrl(e);return r.patch(t,e)},query:function(e){return this._post(e)},retrieve:function(e){return this._get(e)},create:function(e){return this._post(e)},update:function(e){return this._put(e)},"delete":function(e){return this._delete(e)},patch:function(e){return this._patch(e)},init:function(e){i(this,e)}});return o}),define("skylark-langx/Stateful",["./Evented"],function(e){var t=e.inherit({init:function(e,t){var n=e||{};t||(t={}),this.cid=uniqueId(this.cidPrefix),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{});var r=result(this,"defaults");n=mixin({},r,n),this.set(n,t),this.changed={}},changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",toJSON:function(e){return clone(this.attributes)},get:function(e){return this.attributes[e]},has:function(e){return null!=this.get(e)},set:function(e,t,n){if(null==e)return this;var r;if("object"==typeof e?(r=e,n=t):(r={})[e]=t,n||(n={}),!this._validate(r,n))return!1;var i=n.unset,s=n.silent,o=[],a=this._changing;this._changing=!0,a||(this._previousAttributes=clone(this.attributes),this.changed={});var u=this.attributes,l=this.changed,c=this._previousAttributes;for(var h in r)t=r[h],isEqual(u[h],t)||o.push(h),isEqual(c[h],t)?delete l[h]:l[h]=t,i?delete u[h]:u[h]=t;if(this.idAttribute in r&&(this.id=this.get(this.idAttribute)),!s){o.length&&(this._pending=n);for(var f=0;f<o.length;f++)this.trigger("change:"+o[f],this,u[o[f]],n)}if(a)return this;if(!s)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,mixin({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,mixin({},e,{unset:!0}))},hasChanged:function(e){return null==e?!isEmptyObject(this.changed):void 0!==this.changed[e]},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&clone(this.changed);var t=this._changing?this._previousAttributes:this.attributes,n={};for(var r in e){var i=e[r];isEqual(t[r],i)||(n[r]=i)}return!isEmptyObject(n)&&n},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return clone(this._previousAttributes)},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},mixin({},e,{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=mixin({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return!n||(this.trigger("invalid",this,n,mixin(t,{validationError:n})),!1)}});return t}),define("skylark-langx/langx",["./skylark","./arrays","./ArrayStore","./aspect","./async","./Deferred","./Evented","./funcs","./klass","./objects","./Restful","./Stateful","./strings","./types","./Xhr"],function(e,t,n,r,i,s,o,a,u,l,c,h,f,p,d){"use strict";function g(e,t){var n=new CustomEvent(e,t);return w(n,t)}function y(e,t,n,r){return j(t)?t.call(e,n,r):t}function m(e){var e=e||window.location.href,t=e.split("?"),n={};return t.length>1&&t[1].split("&").forEach(function(e){var t=e.split("=");n[t[0]]=t[1]}),n}function v(e){return parseFloat(e)||0}function b(e){return e._uid||(e._uid=A++)}function x(e){var t=++S+"";return e?e+t:t}function k(){return k}var _=({}.toString,Array.prototype.concat,Array.prototype.indexOf,Array.prototype.slice,Array.prototype.filter,l.mixin),w=l.safeMixin,j=p.isFunction,A=1,S=0;return _(k,{createEvent:g,funcArg:y,getQueryParams:m,toPixel:v,uid:b,uniqueId:x,URL:"undefined"!=typeof window?window.URL||window.webkitURL:null}),_(k,t,r,a,l,f,p,{ArrayStore:n,async:i,Deferred:s,Evented:o,klass:u,Restful:c,Stateful:h,Xhr:d}),e.langx=k}),define("skylark-utils-md/primitives/marked",[],function(){function e(e){this.tokens=[],this.tokens.links={},this.options=e||l.defaults,this.rules=c.normal,this.options.gfm&&(this.options.tables?this.rules=c.tables:this.rules=c.gfm)}function t(e,t){if(this.options=t||l.defaults,this.links=e,this.rules=h.normal,this.renderer=this.options.renderer||new n,this.renderer.options=this.options,!this.links)throw new Error("Tokens array requires a `links` property.");this.options.gfm?this.options.breaks?this.rules=h.breaks:this.rules=h.gfm:this.options.pedantic&&(this.rules=h.pedantic)}function n(e){this.options=e||{}}function r(e){this.tokens=[],this.token=null,this.options=e||l.defaults,this.options.renderer=this.options.renderer||new n,this.renderer=this.options.renderer,this.renderer.options=this.options}function i(e,t){return e.replace(t?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function s(e){return e.replace(/&([#\w]+);/g,function(e,t){return t=t.toLowerCase(),"colon"===t?":":"#"===t.charAt(0)?"x"===t.charAt(1)?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""})}function o(e,t){return e=e.source,t=t||"",function n(r,i){return r?(i=i.source||i,i=i.replace(/(^|[^\[])\^/g,"$1"),e=e.replace(r,i),n):new RegExp(e,t)}}function a(){}function u(e){for(var t,n,r=1;r<arguments.length;r++){t=arguments[r];for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}function l(t,n,s){if(s||"function"==typeof n){s||(s=n,n=null),n=u({},l.defaults,n||{});var o,a,c=n.highlight,h=0;try{o=e.lex(t,n)}catch(f){return s(f)}a=o.length;var p=function(e){if(e)return n.highlight=c,s(e);var t;try{t=r.parse(o,n)}catch(i){e=i}return n.highlight=c,e?s(e):s(null,t)};if(!c||c.length<3)return p();if(delete n.highlight,!a)return p();for(;h<o.length;h++)!function(e){return"code"!==e.type?--a||p():c(e.text,e.lang,function(t,n){return t?p(t):null==n||n===e.text?--a||p():(e.text=n,e.escaped=!0,void(--a||p()))})}(o[h])}else try{return n&&(n=u({},l.defaults,n)),r.parse(e.lex(t,n),n)}catch(f){if(f.message+="\nPlease report this to https://github.com/chjj/marked.",(n||l.defaults).silent)return"<p>An error occured:</p><pre>"+i(f.message+"",!0)+"</pre>";throw f}}var c={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:a,hr:/^( *[-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,nptable:a,lheading:/^([^\n]+)\n *(=|-){2,} *(?:\n+|$)/,blockquote:/^( *>[^\n]+(\n(?!def)[^\n]+)*\n*)+/,list:/^( *)(bull) [\s\S]+?(?:hr|def|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment *(?:\n|\s*$)|closed *(?:\n{2,}|\s*$)|closing *(?:\n{2,}|\s*$))/,def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,table:a,paragraph:/^((?:[^\n]+\n?(?!hr|heading|lheading|blockquote|tag|def))+)\n*/,text:/^[^\n]+/};c.bullet=/(?:[*+-]|\d+\.)/,c.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/,c.item=o(c.item,"gm")(/bull/g,c.bullet)(),c.list=o(c.list)(/bull/g,c.bullet)("hr","\\n+(?=\\1?(?:[-*_] *){3,}(?:\\n+|$))")("def","\\n+(?="+c.def.source+")")(),c.blockquote=o(c.blockquote)("def",c.def)(),c._tag="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:/|[^\\w\\s@]*@)\\b",c.html=o(c.html)("comment",/<!--[\s\S]*?-->/)("closed",/<(tag)[\s\S]+?<\/\1>/)("closing",/<tag(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,c._tag)(),c.paragraph=o(c.paragraph)("hr",c.hr)("heading",c.heading)("lheading",c.lheading)("blockquote",c.blockquote)("tag","<"+c._tag)("def",c.def)(),c.normal=u({},c),c.gfm=u({},c.normal,{fences:/^ *(`{3,}|~{3,}) *(\S+)? *\n([\s\S]+?)\s*\1 *(?:\n+|$)/,paragraph:/^/}),c.gfm.paragraph=o(c.paragraph)("(?!","(?!"+c.gfm.fences.source.replace("\\1","\\2")+"|"+c.list.source.replace("\\1","\\3")+"|")(),
c.tables=u({},c.gfm,{nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/}),e.rules=c,e.lex=function(t,n){var r=new e(n);return r.lex(t)},e.prototype.lex=function(e){return e=e.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n"),this.token(e,!0)},e.prototype.token=function(e,t,n){for(var r,i,s,o,a,u,l,h,f,e=e.replace(/^ +$/gm,"");e;)if((s=this.rules.newline.exec(e))&&(e=e.substring(s[0].length),s[0].length>1&&this.tokens.push({type:"space"})),s=this.rules.code.exec(e))e=e.substring(s[0].length),s=s[0].replace(/^ {4}/gm,""),this.tokens.push({type:"code",text:this.options.pedantic?s:s.replace(/\n+$/,"")});else if(s=this.rules.fences.exec(e))e=e.substring(s[0].length),this.tokens.push({type:"code",lang:s[2],text:s[3]});else if(s=this.rules.heading.exec(e))e=e.substring(s[0].length),this.tokens.push({type:"heading",depth:s[1].length,text:s[2]});else if(t&&(s=this.rules.nptable.exec(e))){for(e=e.substring(s[0].length),u={type:"table",header:s[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:s[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:s[3].replace(/\n$/,"").split("\n")},h=0;h<u.align.length;h++)/^ *-+: *$/.test(u.align[h])?u.align[h]="right":/^ *:-+: *$/.test(u.align[h])?u.align[h]="center":/^ *:-+ *$/.test(u.align[h])?u.align[h]="left":u.align[h]=null;for(h=0;h<u.cells.length;h++)u.cells[h]=u.cells[h].split(/ *\| */);this.tokens.push(u)}else if(s=this.rules.lheading.exec(e))e=e.substring(s[0].length),this.tokens.push({type:"heading",depth:"="===s[2]?1:2,text:s[1]});else if(s=this.rules.hr.exec(e))e=e.substring(s[0].length),this.tokens.push({type:"hr"});else if(s=this.rules.blockquote.exec(e))e=e.substring(s[0].length),this.tokens.push({type:"blockquote_start"}),s=s[0].replace(/^ *> ?/gm,""),this.token(s,t,!0),this.tokens.push({type:"blockquote_end"});else if(s=this.rules.list.exec(e)){for(e=e.substring(s[0].length),o=s[2],this.tokens.push({type:"list_start",ordered:o.length>1}),s=s[0].match(this.rules.item),r=!1,f=s.length,h=0;h<f;h++)u=s[h],l=u.length,u=u.replace(/^ *([*+-]|\d+\.) +/,""),~u.indexOf("\n ")&&(l-=u.length,u=this.options.pedantic?u.replace(/^ {1,4}/gm,""):u.replace(new RegExp("^ {1,"+l+"}","gm"),"")),this.options.smartLists&&h!==f-1&&(a=c.bullet.exec(s[h+1])[0],o===a||o.length>1&&a.length>1||(e=s.slice(h+1).join("\n")+e,h=f-1)),i=r||/\n\n(?!\s*$)/.test(u),h!==f-1&&(r="\n"===u.charAt(u.length-1),i||(i=r)),this.tokens.push({type:i?"loose_item_start":"list_item_start"}),this.token(u,!1,n),this.tokens.push({type:"list_item_end"});this.tokens.push({type:"list_end"})}else if(s=this.rules.html.exec(e))e=e.substring(s[0].length),this.tokens.push({type:this.options.sanitize?"paragraph":"html",pre:"pre"===s[1]||"script"===s[1]||"style"===s[1],text:s[0]});else if(!n&&t&&(s=this.rules.def.exec(e)))e=e.substring(s[0].length),this.tokens.links[s[1].toLowerCase()]={href:s[2],title:s[3]};else if(t&&(s=this.rules.table.exec(e))){for(e=e.substring(s[0].length),u={type:"table",header:s[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:s[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:s[3].replace(/(?: *\| *)?\n$/,"").split("\n")},h=0;h<u.align.length;h++)/^ *-+: *$/.test(u.align[h])?u.align[h]="right":/^ *:-+: *$/.test(u.align[h])?u.align[h]="center":/^ *:-+ *$/.test(u.align[h])?u.align[h]="left":u.align[h]=null;for(h=0;h<u.cells.length;h++)u.cells[h]=u.cells[h].replace(/^ *\| *| *\| *$/g,"").split(/ *\| */);this.tokens.push(u)}else if(t&&(s=this.rules.paragraph.exec(e)))e=e.substring(s[0].length),this.tokens.push({type:"paragraph",text:"\n"===s[1].charAt(s[1].length-1)?s[1].slice(0,-1):s[1]});else if(s=this.rules.text.exec(e))e=e.substring(s[0].length),this.tokens.push({type:"text",text:s[0]});else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0));return this.tokens};var h={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<([^ >]+(@|:\/)[^ >]+)>/,url:a,tag:/^<!--[\s\S]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^\b_((?:__|[\s\S])+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,code:/^(`+)\s*([\s\S]*?[^`])\s*\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,del:a,text:/^[\s\S]+?(?=[\\<!\[_*`]| {2,}\n|$)/};return h._inside=/(?:\[[^\]]*\]|[^\[\]]|\](?=[^\[]*\]))*/,h._href=/\s*<?([\s\S]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/,h.link=o(h.link)("inside",h._inside)("href",h._href)(),h.reflink=o(h.reflink)("inside",h._inside)(),h.normal=u({},h),h.pedantic=u({},h.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/}),h.gfm=u({},h.normal,{escape:o(h.escape)("])","~|])")(),url:/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/,del:/^~~(?=\S)([\s\S]*?\S)~~/,text:o(h.text)("]|","~]|")("|","|https?://|")()}),h.breaks=u({},h.gfm,{br:o(h.br)("{2,}","*")(),text:o(h.gfm.text)("{2,}","*")()}),t.rules=h,t.output=function(e,n,r){var i=new t(n,r);return i.output(e)},t.prototype.output=function(e){for(var t,n,r,s,o="";e;)if(s=this.rules.escape.exec(e))e=e.substring(s[0].length),o+=s[1];else if(s=this.rules.autolink.exec(e))e=e.substring(s[0].length),"@"===s[2]?(n=":"===s[1].charAt(6)?this.mangle(s[1].substring(7)):this.mangle(s[1]),r=this.mangle("mailto:")+n):(n=i(s[1]),r=n),o+=this.renderer.link(r,null,n);else if(this.inLink||!(s=this.rules.url.exec(e))){if(s=this.rules.tag.exec(e))!this.inLink&&/^<a /i.test(s[0])?this.inLink=!0:this.inLink&&/^<\/a>/i.test(s[0])&&(this.inLink=!1),e=e.substring(s[0].length),o+=this.options.sanitize?i(s[0]):s[0];else if(s=this.rules.link.exec(e))e=e.substring(s[0].length),this.inLink=!0,o+=this.outputLink(s,{href:s[2],title:s[3]}),this.inLink=!1;else if((s=this.rules.reflink.exec(e))||(s=this.rules.nolink.exec(e))){if(e=e.substring(s[0].length),t=(s[2]||s[1]).replace(/\s+/g," "),t=this.links[t.toLowerCase()],!t||!t.href){o+=s[0].charAt(0),e=s[0].substring(1)+e;continue}this.inLink=!0,o+=this.outputLink(s,t),this.inLink=!1}else if(s=this.rules.strong.exec(e))e=e.substring(s[0].length),o+=this.renderer.strong(this.output(s[2]||s[1]));else if(s=this.rules.em.exec(e))e=e.substring(s[0].length),o+=this.renderer.em(this.output(s[2]||s[1]));else if(s=this.rules.code.exec(e))e=e.substring(s[0].length),o+=this.renderer.codespan(i(s[2],!0));else if(s=this.rules.br.exec(e))e=e.substring(s[0].length),o+=this.renderer.br();else if(s=this.rules.del.exec(e))e=e.substring(s[0].length),o+=this.renderer.del(this.output(s[1]));else if(s=this.rules.text.exec(e))e=e.substring(s[0].length),o+=i(this.smartypants(s[0]));else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0))}else e=e.substring(s[0].length),n=i(s[1]),r=n,o+=this.renderer.link(r,null,n);return o},t.prototype.outputLink=function(e,t){var n=i(t.href),r=t.title?i(t.title):null;return"!"!==e[0].charAt(0)?this.renderer.link(n,r,this.output(e[1])):this.renderer.image(n,r,i(e[1]))},t.prototype.smartypants=function(e){return this.options.smartypants?e.replace(/--/g,"—").replace(/(^|[-\u2014\/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014\/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…"):e},t.prototype.mangle=function(e){for(var t,n="",r=e.length,i=0;i<r;i++)t=e.charCodeAt(i),Math.random()>.5&&(t="x"+t.toString(16)),n+="&#"+t+";";return n},n.prototype.code=function(e,t,n){if(this.options.highlight){var r=this.options.highlight(e,t);null!=r&&r!==e&&(n=!0,e=r)}return t?'<pre><code class="'+this.options.langPrefix+i(t,!0)+'">'+(n?e:i(e,!0))+"\n</code></pre>\n":"<pre><code>"+(n?e:i(e,!0))+"\n</code></pre>"},n.prototype.blockquote=function(e){return"<blockquote>\n"+e+"</blockquote>\n"},n.prototype.html=function(e){return e},n.prototype.heading=function(e,t,n){return"<h"+t+' id="'+this.options.headerPrefix+n.toLowerCase().replace(/[^\w]+/g,"-")+'">'+e+"</h"+t+">\n"},n.prototype.hr=function(){return this.options.xhtml?"<hr/>\n":"<hr>\n"},n.prototype.list=function(e,t){var n=t?"ol":"ul";return"<"+n+">\n"+e+"</"+n+">\n"},n.prototype.listitem=function(e){return"<li>"+e+"</li>\n"},n.prototype.paragraph=function(e){return"<p>"+e+"</p>\n"},n.prototype.table=function(e,t){return"<table>\n<thead>\n"+e+"</thead>\n<tbody>\n"+t+"</tbody>\n</table>\n"},n.prototype.tablerow=function(e){return"<tr>\n"+e+"</tr>\n"},n.prototype.tablecell=function(e,t){var n=t.header?"th":"td",r=t.align?"<"+n+' style="text-align:'+t.align+'">':"<"+n+">";return r+e+"</"+n+">\n"},n.prototype.strong=function(e){return"<strong>"+e+"</strong>"},n.prototype.em=function(e){return"<em>"+e+"</em>"},n.prototype.codespan=function(e){return"<code>"+e+"</code>"},n.prototype.br=function(){return this.options.xhtml?"<br/>":"<br>"},n.prototype.del=function(e){return"<del>"+e+"</del>"},n.prototype.link=function(e,t,n){if(this.options.sanitize){try{var r=decodeURIComponent(s(e)).replace(/[^\w:]/g,"").toLowerCase()}catch(i){return""}if(0===r.indexOf("javascript:"))return""}var o='<a href="'+e+'"';return t&&(o+=' title="'+t+'"'),o+=">"+n+"</a>"},n.prototype.image=function(e,t,n){var r='<img src="'+e+'" alt="'+n+'"';return t&&(r+=' title="'+t+'"'),r+=this.options.xhtml?"/>":">"},r.parse=function(e,t,n){var i=new r(t,n);return i.parse(e)},r.prototype.parse=function(e){this.inline=new t(e.links,this.options,this.renderer),this.tokens=e.reverse();for(var n="";this.next();)n+=this.tok();return n},r.prototype.next=function(){return this.token=this.tokens.pop()},r.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0},r.prototype.parseText=function(){for(var e=this.token.text;"text"===this.peek().type;)e+="\n"+this.next().text;return this.inline.output(e)},r.prototype.tok=function(){switch(this.token.type){case"space":return"";case"hr":return this.renderer.hr();case"heading":return this.renderer.heading(this.inline.output(this.token.text),this.token.depth,this.token.text);case"code":return this.renderer.code(this.token.text,this.token.lang,this.token.escaped);case"table":var e,t,n,r,i,s="",o="";for(n="",e=0;e<this.token.header.length;e++)r={header:!0,align:this.token.align[e]},n+=this.renderer.tablecell(this.inline.output(this.token.header[e]),{header:!0,align:this.token.align[e]});for(s+=this.renderer.tablerow(n),e=0;e<this.token.cells.length;e++){for(t=this.token.cells[e],n="",i=0;i<t.length;i++)n+=this.renderer.tablecell(this.inline.output(t[i]),{header:!1,align:this.token.align[i]});o+=this.renderer.tablerow(n)}return this.renderer.table(s,o);case"blockquote_start":for(var o="";"blockquote_end"!==this.next().type;)o+=this.tok();return this.renderer.blockquote(o);case"list_start":for(var o="",a=this.token.ordered;"list_end"!==this.next().type;)o+=this.tok();return this.renderer.list(o,a);case"list_item_start":for(var o="";"list_item_end"!==this.next().type;)o+="text"===this.token.type?this.parseText():this.tok();return this.renderer.listitem(o);case"loose_item_start":for(var o="";"list_item_end"!==this.next().type;)o+=this.tok();return this.renderer.listitem(o);case"html":var u=this.token.pre||this.options.pedantic?this.token.text:this.inline.output(this.token.text);return this.renderer.html(u);case"paragraph":return this.renderer.paragraph(this.inline.output(this.token.text));case"text":return this.renderer.paragraph(this.parseText())}},a.exec=a,l.options=l.setOptions=function(e){return u(l.defaults,e),l},l.defaults={gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!1,silent:!1,highlight:null,langPrefix:"lang-",smartypants:!1,headerPrefix:"",renderer:new n,xhtml:!1},l.Parser=r,l.parser=r.parse,l.Renderer=n,l.Lexer=e,l.lexer=e.lex,l.InlineLexer=t,l.inlineLexer=t.output,l.parse=l,l}),define("skylark-utils-md/Parser",["skylark-langx/langx","./markdown","./primitives/marked"],function(e,t,n){var r=n.Parser;return e.mixin(r,n),r}),define("skylark-utils-md/primitives/turndown",[],function(){"use strict";function e(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}return e}function t(e,t){return Array(t+1).join(e)}function n(e){return S.indexOf(e.nodeName.toLowerCase())!==-1}function r(e){return E.indexOf(e.nodeName.toLowerCase())!==-1}function i(e){return e.querySelector&&e.querySelector(T)}function s(e){this.options=e,this._keep=[],this._remove=[],this.blankRule={replacement:e.blankReplacement},this.keepReplacement=e.keepReplacement,this.defaultRule={replacement:e.defaultReplacement},this.array=[];for(var t in e.rules)this.array.push(e.rules[t])}function o(e,t,n){for(var r=0;r<e.length;r++){var i=e[r];if(a(i,t,n))return i}}function a(e,t,n){var r=e.filter;if("string"==typeof r){if(r===t.nodeName.toLowerCase())return!0}else if(Array.isArray(r)){if(r.indexOf(t.nodeName.toLowerCase())>-1)return!0}else{if("function"!=typeof r)throw new TypeError("`filter` needs to be a string, array, or function");if(r.call(e,t,n))return!0}}function u(e){var t=e.element,n=e.isBlock,r=e.isVoid,i=e.isPre||function(e){return"PRE"===e.nodeName};if(t.firstChild&&!i(t)){for(var s=null,o=!1,a=null,u=c(a,t,i);u!==t;){if(3===u.nodeType||4===u.nodeType){var h=u.data.replace(/[ \r\n\t]+/g," ");if(s&&!/ $/.test(s.data)||o||" "!==h[0]||(h=h.substr(1)),!h){u=l(u);continue}u.data=h,s=u}else{if(1!==u.nodeType){u=l(u);continue}n(u)||"BR"===u.nodeName?(s&&(s.data=s.data.replace(/ $/,"")),s=null,o=!1):r(u)&&(s=null,o=!0)}var f=c(a,u,i);a=u,u=f}s&&(s.data=s.data.replace(/ $/,""),s.data||l(s))}}function l(e){var t=e.nextSibling||e.parentNode;return e.parentNode.removeChild(e),t}function c(e,t,n){return e&&e.parentNode===t||n(t)?t.nextSibling||t.parentNode:t.firstChild||t.nextSibling||t.parentNode}function h(){var e=C.DOMParser,t=!1;try{(new e).parseFromString("","text/html")&&(t=!0)}catch(n){}return t}function f(){var e=function(){},t=require("jsdom").JSDOM;return e.prototype.parseFromString=function(e){return new t(e).window.document},e}function p(e){var t;if("string"==typeof e){var i=d().parseFromString('<x-turndown id="turndown-root">'+e+"</x-turndown>","text/html");t=i.getElementById("turndown-root")}else t=e.cloneNode(!0);return u({element:t,isBlock:n,isVoid:r}),t}function d(){return q=q||new R}function g(e){return e.isBlock=n(e),e.isCode="code"===e.nodeName.toLowerCase()||e.parentNode.isCode,e.isBlank=y(e),e.flankingWhitespace=m(e),e}function y(e){return["A","TH","TD","IFRAME","SCRIPT","AUDIO","VIDEO"].indexOf(e.nodeName)===-1&&/^\s*$/i.test(e.textContent)&&!r(e)&&!i(e)}function m(e){var t="",n="";if(!e.isBlock){var r=/^[ \r\n\t]/.test(e.textContent),i=/[ \r\n\t]$/.test(e.textContent);r&&!v("left",e)&&(t=" "),i&&!v("right",e)&&(n=" ")}return{leading:t,trailing:n}}function v(e,t){var r,i,s;return"left"===e?(r=t.previousSibling,i=/ $/):(r=t.nextSibling,i=/^ /),r&&(3===r.nodeType?s=i.test(r.nodeValue):1!==r.nodeType||n(r)||(s=i.test(r.textContent))),s}function b(t){if(!(this instanceof b))return new b(t);var n={rules:O,headingStyle:"setext",hr:"* * *",bulletListMarker:"*",codeBlockStyle:"indented",fence:"```",emDelimiter:"_",strongDelimiter:"**",linkStyle:"inlined",linkReferenceStyle:"full",br:"  ",blankReplacement:function(e,t){return t.isBlock?"\n\n":""},keepReplacement:function(e,t){return t.isBlock?"\n\n"+t.outerHTML+"\n\n":t.outerHTML},defaultReplacement:function(e,t){return t.isBlock?"\n\n"+e+"\n\n":e}};this.options=e({},n,t),this.rules=new s(this.options)}function x(e){var t=this;return $.call(e.childNodes,function(e,n){n=new g(n);var r="";return 3===n.nodeType?r=n.isCode?n.nodeValue:t.escape(n.nodeValue):1===n.nodeType&&(r=_.call(t,n)),j(e,r)},"")}function k(e){var t=this;return this.rules.forEach(function(n){"function"==typeof n.append&&(e=j(e,n.append(t.options)))}),e.replace(/^[\t\r\n]+/,"").replace(/[\t\r\n\s]+$/,"")}function _(e){var t=this.rules.forNode(e),n=x.call(this,e),r=e.flankingWhitespace;return(r.leading||r.trailing)&&(n=n.trim()),r.leading+t.replacement(n,e,this.options)+r.trailing}function w(e,t){var n=[e.match(P)[0],t.match(N)[0]].sort(),r=n[n.length-1];return r.length<2?r:"\n\n"}function j(e,t){var n=w(e,t);return e=e.replace(P,""),t=t.replace(N,""),e+n+t}function A(e){return null!=e&&("string"==typeof e||e.nodeType&&(1===e.nodeType||9===e.nodeType||11===e.nodeType))}var S=["address","article","aside","audio","blockquote","body","canvas","center","dd","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frameset","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","isindex","li","main","menu","nav","noframes","noscript","ol","output","p","pre","section","table","tbody","td","tfoot","th","thead","tr","ul"],E=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],T=E.join(),O={};O.paragraph={filter:"p",replacement:function(e){return"\n\n"+e+"\n\n"}},O.lineBreak={filter:"br",replacement:function(e,t,n){return n.br+"\n"}},O.heading={filter:["h1","h2","h3","h4","h5","h6"],replacement:function(e,n,r){var i=Number(n.nodeName.charAt(1));if("setext"===r.headingStyle&&i<3){var s=t(1===i?"=":"-",e.length);return"\n\n"+e+"\n"+s+"\n\n"}return"\n\n"+t("#",i)+" "+e+"\n\n"}},O.blockquote={filter:"blockquote",replacement:function(e){return e=e.replace(/^\n+|\n+$/g,""),e=e.replace(/^/gm,"> "),"\n\n"+e+"\n\n"}},O.list={filter:["ul","ol"],replacement:function(e,t){var n=t.parentNode;return"LI"===n.nodeName&&n.lastElementChild===t?"\n"+e:"\n\n"+e+"\n\n"}},O.listItem={filter:"li",replacement:function(e,t,n){e=e.replace(/^\n+/,"").replace(/\n+$/,"\n").replace(/\n/gm,"\n    ");var r=n.bulletListMarker+"   ",i=t.parentNode;if("OL"===i.nodeName){var s=i.getAttribute("start"),o=Array.prototype.indexOf.call(i.children,t);r=(s?Number(s)+o:o+1)+".  "}return r+e+(t.nextSibling&&!/\n$/.test(e)?"\n":"")}},O.indentedCodeBlock={filter:function(e,t){return"indented"===t.codeBlockStyle&&"PRE"===e.nodeName&&e.firstChild&&"CODE"===e.firstChild.nodeName},replacement:function(e,t,n){return"\n\n    "+t.firstChild.textContent.replace(/\n/g,"\n    ")+"\n\n"}},O.fencedCodeBlock={filter:function(e,t){return"fenced"===t.codeBlockStyle&&"PRE"===e.nodeName&&e.firstChild&&"CODE"===e.firstChild.nodeName},replacement:function(e,t,n){var r=t.firstChild.className||"",i=(r.match(/language-(\S+)/)||[null,""])[1];return"\n\n"+n.fence+i+"\n"+t.firstChild.textContent+"\n"+n.fence+"\n\n"}},O.horizontalRule={filter:"hr",replacement:function(e,t,n){return"\n\n"+n.hr+"\n\n"}},O.inlineLink={filter:function(e,t){return"inlined"===t.linkStyle&&"A"===e.nodeName&&e.getAttribute("href")},replacement:function(e,t){var n=t.getAttribute("href"),r=t.title?' "'+t.title+'"':"";return"["+e+"]("+n+r+")"}},O.referenceLink={filter:function(e,t){return"referenced"===t.linkStyle&&"A"===e.nodeName&&e.getAttribute("href")},replacement:function(e,t,n){var r,i,s=t.getAttribute("href"),o=t.title?' "'+t.title+'"':"";switch(n.linkReferenceStyle){case"collapsed":r="["+e+"][]",i="["+e+"]: "+s+o;break;case"shortcut":r="["+e+"]",i="["+e+"]: "+s+o;break;default:var a=this.references.length+1;r="["+e+"]["+a+"]",i="["+a+"]: "+s+o}return this.references.push(i),r},references:[],append:function(e){var t="";return this.references.length&&(t="\n\n"+this.references.join("\n")+"\n\n",this.references=[]),t}},O.emphasis={filter:["em","i"],replacement:function(e,t,n){return e.trim()?n.emDelimiter+e+n.emDelimiter:""}},O.strong={filter:["strong","b"],replacement:function(e,t,n){return e.trim()?n.strongDelimiter+e+n.strongDelimiter:""}},O.code={filter:function(e){var t=e.previousSibling||e.nextSibling,n="PRE"===e.parentNode.nodeName&&!t;return"CODE"===e.nodeName&&!n},replacement:function(e){if(!e.trim())return"";var t="`",n="",r="",i=e.match(/`+/gm);if(i)for(/^`/.test(e)&&(n=" "),/`$/.test(e)&&(r=" ");i.indexOf(t)!==-1;)t+="`";return t+n+e+r+t}},O.image={filter:"img",replacement:function(e,t){var n=t.alt||"",r=t.getAttribute("src")||"",i=t.title||"",s=i?' "'+i+'"':"";return r?"!["+n+"]("+r+s+")":""}},s.prototype={add:function(e,t){this.array.unshift(t)},keep:function(e){this._keep.unshift({filter:e,replacement:this.keepReplacement})},remove:function(e){this._remove.unshift({filter:e,replacement:function(){return""}})},forNode:function(e){if(e.isBlank)return this.blankRule;var t;return(t=o(this.array,e,this.options))?t:(t=o(this._keep,e,this.options))?t:(t=o(this._remove,e,this.options))?t:this.defaultRule},forEach:function(e){for(var t=0;t<this.array.length;t++)e(this.array[t],t)}};var q,C="undefined"!=typeof window?window:{},R=h()?C.DOMParser:f(),$=Array.prototype.reduce,N=/^\n*/,P=/\n*$/,D=[[/\\/g,"\\\\"],[/\*/g,"\\*"],[/^-/g,"\\-"],[/^\+ /g,"\\+ "],[/^(=+)/g,"\\$1"],[/^(#{1,6}) /g,"\\$1 "],[/`/g,"\\`"],[/^~~~/g,"\\~~~"],[/\[/g,"\\["],[/\]/g,"\\]"],[/^>/g,"\\>"],[/_/g,"\\_"],[/^(\d+)\. /g,"$1\\. "]];return b.prototype={turndown:function(e){if(!A(e))throw new TypeError(e+" is not a string, or an element/document/fragment node.");if(""===e)return"";var t=x.call(this,new p(e));return k.call(this,t)},use:function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this.use(e[t]);else{if("function"!=typeof e)throw new TypeError("plugin must be a Function or an Array of Functions");e(this)}return this},addRule:function(e,t){return this.rules.add(e,t),this},keep:function(e){return this.rules.keep(e),this},remove:function(e){return this.rules.remove(e),this},escape:function(e){return D.reduce(function(e,t){return e.replace(t[0],t[1])},e)}},b}),define("skylark-utils-md/Turndown",["skylark-langx/langx","./markdown","./primitives/turndown"],function(e,t,n){return t.Turndown=n}),define("skylark-utils-md/main",["./markdown","./Parser","./Turndown"],function(e){return e}),define("skylark-utils-md",["skylark-utils-md/main"],function(e){return e})},this);
//# sourceMappingURL=sourcemaps/skylark-utils-md-all.js.map
