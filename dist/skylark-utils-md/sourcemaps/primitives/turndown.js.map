{"version":3,"sources":["primitives/turndown.js"],"names":["define","extend","destination","i","arguments","length","source","key","hasOwnProperty","repeat","character","count","Array","join","isBlock","node","blockElements","indexOf","nodeName","toLowerCase","isVoid","voidElements","hasVoid","querySelector","voidSelector","Rules","options","this","_keep","_remove","blankRule","replacement","blankReplacement","keepReplacement","defaultRule","defaultReplacement","array","rules","push","findRule","rule","filterValue","filter","isArray","TypeError","call","collapseWhitespace","element","isPre","firstChild","prevText","prevVoid","prev","next","nodeType","text","data","replace","test","substr","remove","nextNode","nextSibling","parentNode","removeChild","current","canParseHTMLNatively","Parser","root","DOMParser","canParse","parseFromString","e","createHTMLParser","JSDOM","require","prototype","string","window","document","RootNode","input","doc","htmlParser","getElementById","cloneNode","_htmlParser","HTMLParser","Node","isCode","isBlank","flankingWhitespace","textContent","leading","trailing","hasLeading","hasTrailing","isFlankedByWhitespace","side","sibling","regExp","isFlanked","previousSibling","nodeValue","TurndownService","defaults","headingStyle","hr","bulletListMarker","codeBlockStyle","fence","emDelimiter","strongDelimiter","linkStyle","linkReferenceStyle","br","content","outerHTML","process","self","reduce","childNodes","output","escape","replacementForNode","postProcess","forEach","append","forNode","whitespace","trim","separatingNewlines","newlines","match","trailingNewLinesRegExp","leadingNewLinesRegExp","sort","maxNewlines","string1","string2","separator","canConvert","paragraph","lineBreak","heading","hLevel","Number","charAt","underline","blockquote","list","parent","lastElementChild","listItem","prefix","start","getAttribute","index","children","indentedCodeBlock","fencedCodeBlock","className","language","horizontalRule","inlineLink","href","title","referenceLink","reference","id","references","emphasis","strong","code","hasSiblings","isCodeBlock","delimiter","leadingSpace","trailingSpace","matches","image","alt","src","titlePart","add","unshift","keep","fn","escapes","turndown","use","plugin","addRule","accumulator"],"mappings":"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","file":"../../primitives/turndown.js","sourcesContent":["define([],function () { \n  'use strict';\n\n  // original version : 5.0.1\n  function extend (destination) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n      for (var key in source) {\n        if (source.hasOwnProperty(key)) destination[key] = source[key];\n      }\n    }\n    return destination\n  }\n\n  function repeat (character, count) {\n    return Array(count + 1).join(character)\n  }\n\n  var blockElements = [\n    'address', 'article', 'aside', 'audio', 'blockquote', 'body', 'canvas',\n    'center', 'dd', 'dir', 'div', 'dl', 'dt', 'fieldset', 'figcaption',\n    'figure', 'footer', 'form', 'frameset', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6',\n    'header', 'hgroup', 'hr', 'html', 'isindex', 'li', 'main', 'menu', 'nav',\n    'noframes', 'noscript', 'ol', 'output', 'p', 'pre', 'section', 'table',\n    'tbody', 'td', 'tfoot', 'th', 'thead', 'tr', 'ul'\n  ];\n\n  function isBlock (node) {\n    return blockElements.indexOf(node.nodeName.toLowerCase()) !== -1\n  }\n\n  var voidElements = [\n    'area', 'base', 'br', 'col', 'command', 'embed', 'hr', 'img', 'input',\n    'keygen', 'link', 'meta', 'param', 'source', 'track', 'wbr'\n  ];\n\n  function isVoid (node) {\n    return voidElements.indexOf(node.nodeName.toLowerCase()) !== -1\n  }\n\n  var voidSelector = voidElements.join();\n  function hasVoid (node) {\n    return node.querySelector && node.querySelector(voidSelector)\n  }\n\n  var rules = {};\n\n  rules.paragraph = {\n    filter: 'p',\n\n    replacement: function (content) {\n      return '\\n\\n' + content + '\\n\\n'\n    }\n  };\n\n  rules.lineBreak = {\n    filter: 'br',\n\n    replacement: function (content, node, options) {\n      return options.br + '\\n'\n    }\n  };\n\n  rules.heading = {\n    filter: ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'],\n\n    replacement: function (content, node, options) {\n      var hLevel = Number(node.nodeName.charAt(1));\n\n      if (options.headingStyle === 'setext' && hLevel < 3) {\n        var underline = repeat((hLevel === 1 ? '=' : '-'), content.length);\n        return (\n          '\\n\\n' + content + '\\n' + underline + '\\n\\n'\n        )\n      } else {\n        return '\\n\\n' + repeat('#', hLevel) + ' ' + content + '\\n\\n'\n      }\n    }\n  };\n\n  rules.blockquote = {\n    filter: 'blockquote',\n\n    replacement: function (content) {\n      content = content.replace(/^\\n+|\\n+$/g, '');\n      content = content.replace(/^/gm, '> ');\n      return '\\n\\n' + content + '\\n\\n'\n    }\n  };\n\n  rules.list = {\n    filter: ['ul', 'ol'],\n\n    replacement: function (content, node) {\n      var parent = node.parentNode;\n      if (parent.nodeName === 'LI' && parent.lastElementChild === node) {\n        return '\\n' + content\n      } else {\n        return '\\n\\n' + content + '\\n\\n'\n      }\n    }\n  };\n\n  rules.listItem = {\n    filter: 'li',\n\n    replacement: function (content, node, options) {\n      content = content\n        .replace(/^\\n+/, '') // remove leading newlines\n        .replace(/\\n+$/, '\\n') // replace trailing newlines with just a single one\n        .replace(/\\n/gm, '\\n    '); // indent\n      var prefix = options.bulletListMarker + '   ';\n      var parent = node.parentNode;\n      if (parent.nodeName === 'OL') {\n        var start = parent.getAttribute('start');\n        var index = Array.prototype.indexOf.call(parent.children, node);\n        prefix = (start ? Number(start) + index : index + 1) + '.  ';\n      }\n      return (\n        prefix + content + (node.nextSibling && !/\\n$/.test(content) ? '\\n' : '')\n      )\n    }\n  };\n\n  rules.indentedCodeBlock = {\n    filter: function (node, options) {\n      return (\n        options.codeBlockStyle === 'indented' &&\n        node.nodeName === 'PRE' &&\n        node.firstChild &&\n        node.firstChild.nodeName === 'CODE'\n      )\n    },\n\n    replacement: function (content, node, options) {\n      return (\n        '\\n\\n    ' +\n        node.firstChild.textContent.replace(/\\n/g, '\\n    ') +\n        '\\n\\n'\n      )\n    }\n  };\n\n  rules.fencedCodeBlock = {\n    filter: function (node, options) {\n      return (\n        options.codeBlockStyle === 'fenced' &&\n        node.nodeName === 'PRE' &&\n        node.firstChild &&\n        node.firstChild.nodeName === 'CODE'\n      )\n    },\n\n    replacement: function (content, node, options) {\n      var className = node.firstChild.className || '';\n      var language = (className.match(/language-(\\S+)/) || [null, ''])[1];\n\n      return (\n        '\\n\\n' + options.fence + language + '\\n' +\n        node.firstChild.textContent +\n        '\\n' + options.fence + '\\n\\n'\n      )\n    }\n  };\n\n  rules.horizontalRule = {\n    filter: 'hr',\n\n    replacement: function (content, node, options) {\n      return '\\n\\n' + options.hr + '\\n\\n'\n    }\n  };\n\n  rules.inlineLink = {\n    filter: function (node, options) {\n      return (\n        options.linkStyle === 'inlined' &&\n        node.nodeName === 'A' &&\n        node.getAttribute('href')\n      )\n    },\n\n    replacement: function (content, node) {\n      var href = node.getAttribute('href');\n      var title = node.title ? ' \"' + node.title + '\"' : '';\n      return '[' + content + '](' + href + title + ')'\n    }\n  };\n\n  rules.referenceLink = {\n    filter: function (node, options) {\n      return (\n        options.linkStyle === 'referenced' &&\n        node.nodeName === 'A' &&\n        node.getAttribute('href')\n      )\n    },\n\n    replacement: function (content, node, options) {\n      var href = node.getAttribute('href');\n      var title = node.title ? ' \"' + node.title + '\"' : '';\n      var replacement;\n      var reference;\n\n      switch (options.linkReferenceStyle) {\n        case 'collapsed':\n          replacement = '[' + content + '][]';\n          reference = '[' + content + ']: ' + href + title;\n          break\n        case 'shortcut':\n          replacement = '[' + content + ']';\n          reference = '[' + content + ']: ' + href + title;\n          break\n        default:\n          var id = this.references.length + 1;\n          replacement = '[' + content + '][' + id + ']';\n          reference = '[' + id + ']: ' + href + title;\n      }\n\n      this.references.push(reference);\n      return replacement\n    },\n\n    references: [],\n\n    append: function (options) {\n      var references = '';\n      if (this.references.length) {\n        references = '\\n\\n' + this.references.join('\\n') + '\\n\\n';\n        this.references = []; // Reset references\n      }\n      return references\n    }\n  };\n\n  rules.emphasis = {\n    filter: ['em', 'i'],\n\n    replacement: function (content, node, options) {\n      if (!content.trim()) return ''\n      return options.emDelimiter + content + options.emDelimiter\n    }\n  };\n\n  rules.strong = {\n    filter: ['strong', 'b'],\n\n    replacement: function (content, node, options) {\n      if (!content.trim()) return ''\n      return options.strongDelimiter + content + options.strongDelimiter\n    }\n  };\n\n  rules.code = {\n    filter: function (node) {\n      var hasSiblings = node.previousSibling || node.nextSibling;\n      var isCodeBlock = node.parentNode.nodeName === 'PRE' && !hasSiblings;\n\n      return node.nodeName === 'CODE' && !isCodeBlock\n    },\n\n    replacement: function (content) {\n      if (!content.trim()) return ''\n\n      var delimiter = '`';\n      var leadingSpace = '';\n      var trailingSpace = '';\n      var matches = content.match(/`+/gm);\n      if (matches) {\n        if (/^`/.test(content)) leadingSpace = ' ';\n        if (/`$/.test(content)) trailingSpace = ' ';\n        while (matches.indexOf(delimiter) !== -1) delimiter = delimiter + '`';\n      }\n\n      return delimiter + leadingSpace + content + trailingSpace + delimiter\n    }\n  };\n\n  rules.image = {\n    filter: 'img',\n\n    replacement: function (content, node) {\n      var alt = node.alt || '';\n      var src = node.getAttribute('src') || '';\n      var title = node.title || '';\n      var titlePart = title ? ' \"' + title + '\"' : '';\n      return src ? '![' + alt + ']' + '(' + src + titlePart + ')' : ''\n    }\n  };\n\n  /**\n   * Manages a collection of rules used to convert HTML to Markdown\n   */\n\n  function Rules (options) {\n    this.options = options;\n    this._keep = [];\n    this._remove = [];\n\n    this.blankRule = {\n      replacement: options.blankReplacement\n    };\n\n    this.keepReplacement = options.keepReplacement;\n\n    this.defaultRule = {\n      replacement: options.defaultReplacement\n    };\n\n    this.array = [];\n    for (var key in options.rules) this.array.push(options.rules[key]);\n  }\n\n  Rules.prototype = {\n    add: function (key, rule) {\n      this.array.unshift(rule);\n    },\n\n    keep: function (filter) {\n      this._keep.unshift({\n        filter: filter,\n        replacement: this.keepReplacement\n      });\n    },\n\n    remove: function (filter) {\n      this._remove.unshift({\n        filter: filter,\n        replacement: function () {\n          return ''\n        }\n      });\n    },\n\n    forNode: function (node) {\n      if (node.isBlank) return this.blankRule\n      var rule;\n\n      if ((rule = findRule(this.array, node, this.options))) return rule\n      if ((rule = findRule(this._keep, node, this.options))) return rule\n      if ((rule = findRule(this._remove, node, this.options))) return rule\n\n      return this.defaultRule\n    },\n\n    forEach: function (fn) {\n      for (var i = 0; i < this.array.length; i++) fn(this.array[i], i);\n    }\n  };\n\n  function findRule (rules, node, options) {\n    for (var i = 0; i < rules.length; i++) {\n      var rule = rules[i];\n      if (filterValue(rule, node, options)) return rule\n    }\n    return void 0\n  }\n\n  function filterValue (rule, node, options) {\n    var filter = rule.filter;\n    if (typeof filter === 'string') {\n      if (filter === node.nodeName.toLowerCase()) return true\n    } else if (Array.isArray(filter)) {\n      if (filter.indexOf(node.nodeName.toLowerCase()) > -1) return true\n    } else if (typeof filter === 'function') {\n      if (filter.call(rule, node, options)) return true\n    } else {\n      throw new TypeError('`filter` needs to be a string, array, or function')\n    }\n  }\n\n  /**\n   * The collapseWhitespace function is adapted from collapse-whitespace\n   * by Luc Thevenard.\n   *\n   * The MIT License (MIT)\n   *\n   * Copyright (c) 2014 Luc Thevenard <lucthevenard@gmail.com>\n   *\n   * Permission is hereby granted, free of charge, to any person obtaining a copy\n   * of this software and associated documentation files (the \"Software\"), to deal\n   * in the Software without restriction, including without limitation the rights\n   * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n   * copies of the Software, and to permit persons to whom the Software is\n   * furnished to do so, subject to the following conditions:\n   *\n   * The above copyright notice and this permission notice shall be included in\n   * all copies or substantial portions of the Software.\n   *\n   * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n   * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n   * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n   * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n   * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n   * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n   * THE SOFTWARE.\n   */\n\n  /**\n   * collapseWhitespace(options) removes extraneous whitespace from an the given element.\n   *\n   * @param {Object} options\n   */\n  function collapseWhitespace (options) {\n    var element = options.element;\n    var isBlock = options.isBlock;\n    var isVoid = options.isVoid;\n    var isPre = options.isPre || function (node) {\n      return node.nodeName === 'PRE'\n    };\n\n    if (!element.firstChild || isPre(element)) return\n\n    var prevText = null;\n    var prevVoid = false;\n\n    var prev = null;\n    var node = next(prev, element, isPre);\n\n    while (node !== element) {\n      if (node.nodeType === 3 || node.nodeType === 4) { // Node.TEXT_NODE or Node.CDATA_SECTION_NODE\n        var text = node.data.replace(/[ \\r\\n\\t]+/g, ' ');\n\n        if ((!prevText || / $/.test(prevText.data)) &&\n            !prevVoid && text[0] === ' ') {\n          text = text.substr(1);\n        }\n\n        // `text` might be empty at this point.\n        if (!text) {\n          node = remove(node);\n          continue\n        }\n\n        node.data = text;\n\n        prevText = node;\n      } else if (node.nodeType === 1) { // Node.ELEMENT_NODE\n        if (isBlock(node) || node.nodeName === 'BR') {\n          if (prevText) {\n            prevText.data = prevText.data.replace(/ $/, '');\n          }\n\n          prevText = null;\n          prevVoid = false;\n        } else if (isVoid(node)) {\n          // Avoid trimming space around non-block, non-BR void elements.\n          prevText = null;\n          prevVoid = true;\n        }\n      } else {\n        node = remove(node);\n        continue\n      }\n\n      var nextNode = next(prev, node, isPre);\n      prev = node;\n      node = nextNode;\n    }\n\n    if (prevText) {\n      prevText.data = prevText.data.replace(/ $/, '');\n      if (!prevText.data) {\n        remove(prevText);\n      }\n    }\n  }\n\n  /**\n   * remove(node) removes the given node from the DOM and returns the\n   * next node in the sequence.\n   *\n   * @param {Node} node\n   * @return {Node} node\n   */\n  function remove (node) {\n    var next = node.nextSibling || node.parentNode;\n\n    node.parentNode.removeChild(node);\n\n    return next\n  }\n\n  /**\n   * next(prev, current, isPre) returns the next node in the sequence, given the\n   * current and previous nodes.\n   *\n   * @param {Node} prev\n   * @param {Node} current\n   * @param {Function} isPre\n   * @return {Node}\n   */\n  function next (prev, current, isPre) {\n    if ((prev && prev.parentNode === current) || isPre(current)) {\n      return current.nextSibling || current.parentNode\n    }\n\n    return current.firstChild || current.nextSibling || current.parentNode\n  }\n\n  /*\n   * Set up window for Node.js\n   */\n\n  var root = (typeof window !== 'undefined' ? window : {});\n\n  /*\n   * Parsing HTML strings\n   */\n\n  function canParseHTMLNatively () {\n    var Parser = root.DOMParser;\n    var canParse = false;\n\n    // Adapted from https://gist.github.com/1129031\n    // Firefox/Opera/IE throw errors on unsupported types\n    try {\n      // WebKit returns null on unsupported types\n      if (new Parser().parseFromString('', 'text/html')) {\n        canParse = true;\n      }\n    } catch (e) {}\n\n    return canParse\n  }\n\n  function createHTMLParser () {\n    var Parser = function () {};\n\n    {\n      var JSDOM = require('jsdom').JSDOM;\n      Parser.prototype.parseFromString = function (string) {\n        return new JSDOM(string).window.document\n      };\n    }\n    return Parser\n  }\n\n  var HTMLParser = canParseHTMLNatively() ? root.DOMParser : createHTMLParser();\n\n  function RootNode (input) {\n    var root;\n    if (typeof input === 'string') {\n      var doc = htmlParser().parseFromString(\n        // DOM parsers arrange elements in the <head> and <body>.\n        // Wrapping in a custom element ensures elements are reliably arranged in\n        // a single element.\n        '<x-turndown id=\"turndown-root\">' + input + '</x-turndown>',\n        'text/html'\n      );\n      root = doc.getElementById('turndown-root');\n    } else {\n      root = input.cloneNode(true);\n    }\n    collapseWhitespace({\n      element: root,\n      isBlock: isBlock,\n      isVoid: isVoid\n    });\n\n    return root\n  }\n\n  var _htmlParser;\n  function htmlParser () {\n    _htmlParser = _htmlParser || new HTMLParser();\n    return _htmlParser\n  }\n\n  function Node (node) {\n    node.isBlock = isBlock(node);\n    node.isCode = node.nodeName.toLowerCase() === 'code' || node.parentNode.isCode;\n    node.isBlank = isBlank(node);\n    node.flankingWhitespace = flankingWhitespace(node);\n    return node\n  }\n\n  function isBlank (node) {\n    return (\n      ['A', 'TH', 'TD', 'IFRAME', 'SCRIPT', 'AUDIO', 'VIDEO'].indexOf(node.nodeName) === -1 &&\n      /^\\s*$/i.test(node.textContent) &&\n      !isVoid(node) &&\n      !hasVoid(node)\n    )\n  }\n\n  function flankingWhitespace (node) {\n    var leading = '';\n    var trailing = '';\n\n    if (!node.isBlock) {\n      var hasLeading = /^[ \\r\\n\\t]/.test(node.textContent);\n      var hasTrailing = /[ \\r\\n\\t]$/.test(node.textContent);\n\n      if (hasLeading && !isFlankedByWhitespace('left', node)) {\n        leading = ' ';\n      }\n      if (hasTrailing && !isFlankedByWhitespace('right', node)) {\n        trailing = ' ';\n      }\n    }\n\n    return { leading: leading, trailing: trailing }\n  }\n\n  function isFlankedByWhitespace (side, node) {\n    var sibling;\n    var regExp;\n    var isFlanked;\n\n    if (side === 'left') {\n      sibling = node.previousSibling;\n      regExp = / $/;\n    } else {\n      sibling = node.nextSibling;\n      regExp = /^ /;\n    }\n\n    if (sibling) {\n      if (sibling.nodeType === 3) {\n        isFlanked = regExp.test(sibling.nodeValue);\n      } else if (sibling.nodeType === 1 && !isBlock(sibling)) {\n        isFlanked = regExp.test(sibling.textContent);\n      }\n    }\n    return isFlanked\n  }\n\n  var reduce = Array.prototype.reduce;\n  var leadingNewLinesRegExp = /^\\n*/;\n  var trailingNewLinesRegExp = /\\n*$/;\n  var escapes = [\n    [/\\\\/g, '\\\\\\\\'],\n    [/\\*/g, '\\\\*'],\n    [/^-/g, '\\\\-'],\n    [/^\\+ /g, '\\\\+ '],\n    [/^(=+)/g, '\\\\$1'],\n    [/^(#{1,6}) /g, '\\\\$1 '],\n    [/`/g, '\\\\`'],\n    [/^~~~/g, '\\\\~~~'],\n    [/\\[/g, '\\\\['],\n    [/\\]/g, '\\\\]'],\n    [/^>/g, '\\\\>'],\n    [/_/g, '\\\\_'],\n    [/^(\\d+)\\. /g, '$1\\\\. ']\n  ];\n\n  function TurndownService (options) {\n    if (!(this instanceof TurndownService)) return new TurndownService(options)\n\n    var defaults = {\n      rules: rules,\n      headingStyle: 'setext',\n      hr: '* * *',\n      bulletListMarker: '*',\n      codeBlockStyle: 'indented',\n      fence: '```',\n      emDelimiter: '_',\n      strongDelimiter: '**',\n      linkStyle: 'inlined',\n      linkReferenceStyle: 'full',\n      br: '  ',\n      blankReplacement: function (content, node) {\n        return node.isBlock ? '\\n\\n' : ''\n      },\n      keepReplacement: function (content, node) {\n        return node.isBlock ? '\\n\\n' + node.outerHTML + '\\n\\n' : node.outerHTML\n      },\n      defaultReplacement: function (content, node) {\n        return node.isBlock ? '\\n\\n' + content + '\\n\\n' : content\n      }\n    };\n    this.options = extend({}, defaults, options);\n    this.rules = new Rules(this.options);\n  }\n\n  TurndownService.prototype = {\n    /**\n     * The entry point for converting a string or DOM node to Markdown\n     * @public\n     * @param {String|HTMLElement} input The string or DOM node to convert\n     * @returns A Markdown representation of the input\n     * @type String\n     */\n\n    turndown: function (input) {\n      if (!canConvert(input)) {\n        throw new TypeError(\n          input + ' is not a string, or an element/document/fragment node.'\n        )\n      }\n\n      if (input === '') return ''\n\n      var output = process.call(this, new RootNode(input));\n      return postProcess.call(this, output)\n    },\n\n    /**\n     * Add one or more plugins\n     * @public\n     * @param {Function|Array} plugin The plugin or array of plugins to add\n     * @returns The Turndown instance for chaining\n     * @type Object\n     */\n\n    use: function (plugin) {\n      if (Array.isArray(plugin)) {\n        for (var i = 0; i < plugin.length; i++) this.use(plugin[i]);\n      } else if (typeof plugin === 'function') {\n        plugin(this);\n      } else {\n        throw new TypeError('plugin must be a Function or an Array of Functions')\n      }\n      return this\n    },\n\n    /**\n     * Adds a rule\n     * @public\n     * @param {String} key The unique key of the rule\n     * @param {Object} rule The rule\n     * @returns The Turndown instance for chaining\n     * @type Object\n     */\n\n    addRule: function (key, rule) {\n      this.rules.add(key, rule);\n      return this\n    },\n\n    /**\n     * Keep a node (as HTML) that matches the filter\n     * @public\n     * @param {String|Array|Function} filter The unique key of the rule\n     * @returns The Turndown instance for chaining\n     * @type Object\n     */\n\n    keep: function (filter) {\n      this.rules.keep(filter);\n      return this\n    },\n\n    /**\n     * Remove a node that matches the filter\n     * @public\n     * @param {String|Array|Function} filter The unique key of the rule\n     * @returns The Turndown instance for chaining\n     * @type Object\n     */\n\n    remove: function (filter) {\n      this.rules.remove(filter);\n      return this\n    },\n\n    /**\n     * Escapes Markdown syntax\n     * @public\n     * @param {String} string The string to escape\n     * @returns A string with Markdown syntax escaped\n     * @type String\n     */\n\n    escape: function (string) {\n      return escapes.reduce(function (accumulator, escape) {\n        return accumulator.replace(escape[0], escape[1])\n      }, string)\n    }\n  };\n\n  /**\n   * Reduces a DOM node down to its Markdown string equivalent\n   * @private\n   * @param {HTMLElement} parentNode The node to convert\n   * @returns A Markdown representation of the node\n   * @type String\n   */\n\n  function process (parentNode) {\n    var self = this;\n    return reduce.call(parentNode.childNodes, function (output, node) {\n      node = new Node(node);\n\n      var replacement = '';\n      if (node.nodeType === 3) {\n        replacement = node.isCode ? node.nodeValue : self.escape(node.nodeValue);\n      } else if (node.nodeType === 1) {\n        replacement = replacementForNode.call(self, node);\n      }\n\n      return join(output, replacement)\n    }, '')\n  }\n\n  /**\n   * Appends strings as each rule requires and trims the output\n   * @private\n   * @param {String} output The conversion output\n   * @returns A trimmed version of the ouput\n   * @type String\n   */\n\n  function postProcess (output) {\n    var self = this;\n    this.rules.forEach(function (rule) {\n      if (typeof rule.append === 'function') {\n        output = join(output, rule.append(self.options));\n      }\n    });\n\n    return output.replace(/^[\\t\\r\\n]+/, '').replace(/[\\t\\r\\n\\s]+$/, '')\n  }\n\n  /**\n   * Converts an element node to its Markdown equivalent\n   * @private\n   * @param {HTMLElement} node The node to convert\n   * @returns A Markdown representation of the node\n   * @type String\n   */\n\n  function replacementForNode (node) {\n    var rule = this.rules.forNode(node);\n    var content = process.call(this, node);\n    var whitespace = node.flankingWhitespace;\n    if (whitespace.leading || whitespace.trailing) content = content.trim();\n    return (\n      whitespace.leading +\n      rule.replacement(content, node, this.options) +\n      whitespace.trailing\n    )\n  }\n\n  /**\n   * Determines the new lines between the current output and the replacement\n   * @private\n   * @param {String} output The current conversion output\n   * @param {String} replacement The string to append to the output\n   * @returns The whitespace to separate the current output and the replacement\n   * @type String\n   */\n\n  function separatingNewlines (output, replacement) {\n    var newlines = [\n      output.match(trailingNewLinesRegExp)[0],\n      replacement.match(leadingNewLinesRegExp)[0]\n    ].sort();\n    var maxNewlines = newlines[newlines.length - 1];\n    return maxNewlines.length < 2 ? maxNewlines : '\\n\\n'\n  }\n\n  function join (string1, string2) {\n    var separator = separatingNewlines(string1, string2);\n\n    // Remove trailing/leading newlines and replace with separator\n    string1 = string1.replace(trailingNewLinesRegExp, '');\n    string2 = string2.replace(leadingNewLinesRegExp, '');\n\n    return string1 + separator + string2\n  }\n\n  /**\n   * Determines whether an input can be converted\n   * @private\n   * @param {String|HTMLElement} input Describe this parameter\n   * @returns Describe what it returns\n   * @type String|Object|Array|Boolean|Number\n   */\n\n  function canConvert (input) {\n    return (\n      input != null && (\n        typeof input === 'string' ||\n        (input.nodeType && (\n          input.nodeType === 1 || input.nodeType === 9 || input.nodeType === 11\n        ))\n      )\n    )\n  }\n\n  return TurndownService;\n\n});\n"]}